<!DOCTYPE html>
<head>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="./css styles/side-nav.css">
</head>
<body>
    <h1>Admin Page</h1>
    <div class="sidenav">
        <label ><b>Current</b></label>
        <a id="currentevents" href="javascript:;">Current Events</a>
        <a id="currentquestions" href="javascript:;">Current Questions</a>
        <label></label>
        <label></label>

        <label><b>Events</b></label>
        <a id="eventcreation" href="javascript:;">Create an Event</a>
        <a id="eventdeletion" href="javascript:;">Delete an Event</a>
        <label></label>
        <label></label>

        <label><b>Questions</b></label>
        <a id="questioncreation" href="javascript:;">Create a Question</a>
        <a id="questiondeletion" href="javascript:;">Delete a Question</a>
        <label></label>
        <label></label>

        <label><b>Admins</b></label>
        <a id="admincreation" href="javascript:;">Create another Admin</a>
    </div>

    <div class="main">
        <div id="registration" style="display: none;">
            <label>New Password: </label>
            <input type="password" id="tbPass"/>
            <br/>

            <label>Confirm Password: </label>
            <input type="password" id="tbConfirm"/>
            <br/>

            <button id="btnRegister">Save Password</button>
        </div>
        <div id="createquestion" style="display: none;">
            <label>Question: </label>
            <input id="questiontext"/>
            <br/>

            <label>Answer: </label>
            <input id="questionanswer"/>
            <br/>

            <label>Question Value: </label>
            <input id="questionvalue"/>
            <br/>

            <label>Hint: </label>
            <input id="questionhint"/>
            <br/>

            <label>Hint Value: </label>
            <input id="questionhintvalue"/>
            <br/>
            <br/>
            <button id="submitcreatequestion">Submit Question</button>
        </div>
        <div id="createadmin" style="display: none;">
            <label>Admins will need to login with the entered login name and no password to finish registration.</label>

            <br/>
            <label>First Name: </label>
            <input id="adminfirst"/>
            <br/>

            <label>Last Name: </label>
            <input id="adminlast"/>
            <br/>

            <label>Login Name: </label>
            <input id="adminlogin"/>
            <br/>

            <button id="submitcreateadmin">Submit</button>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            const ajaxUrlQuestions = "http://localhost:8080/api/questions";
            const ajaxUrlAdmins = "http://localhost:8080/api/admins";

            var adminid;
            var passedUrl = window.location.href.toString();
            var registration = false;

            if (passedUrl.includes("&register")) {
                adminid = passedUrl.substring(passedUrl.indexOf('admin=') + 6, passedUrl.indexOf('&register'))
                registration = true;
            }
            else {
                adminid = passedUrl.substring(passedUrl.indexOf('admin=')+6);
            }

            if (registration) {
                document.getElementById("questioncreation").disabled = true;
                document.getElementById("currentevents").disabled = true;
                document.getElementById("currentquestions").disabled = true;
                document.getElementById("eventcreation").disabled = true;
                document.getElementById("eventdeletion").disabled = true;
                document.getElementById("questiondeletion").disabled = true;
                document.getElementById("admincreation").disabled = true;

                document.getElementById("registration").style.display = "block";
            }

            $("#questioncreation").click(function() {
                if (!registration) {
                    document.getElementById("createquestion").style.display = "block";
                    document.getElementById("createadmin").style.display = "none";
                }
            });

            $("#admincreation").click(function() {
                if (!registration) {
                    document.getElementById("createadmin").style.display = "block";
                   document.getElementById("createquestion").style.display = "none";
                }
            });

            $("#btnRegister").click(function() {
                var pass = document.getElementById("tbPass").value;
                var confirm = document.getElementById("tbConfirm").value;

                if (pass === confirm) {
                    $.ajax({
                        type: "PUT",
                        url: ajaxUrlAdmins,
                        data: '{"Admin": "' + adminid + '", "Pwd": "' + pass + '"}',
                        contentType: "application/json"
                    }).done(function(result) {
                        if (result.recordset[0]["success"] != 0) {
                            alert("Success");
                            document.getElementById("questioncreation").disabled = false;
                            document.getElementById("currentevents").disabled = false;
                            document.getElementById("currentquestions").disabled = false;
                            document.getElementById("eventcreation").disabled = false;
                            document.getElementById("eventdeletion").disabled = false;
                            document.getElementById("questiondeletion").disabled = false;
                            document.getElementById("admincreation").disabled = false;

                            registration = false;
                            document.getElementById("tbPass").value = "";
                            document.getElementById("tbConfirm").value = "";
                            document.getElementById("registration").style.display = "none";
                        }
                        else {
                            alert("Unsuccessful");
                        }
                    })
                }
                else {
                    alert("Your passwords don't match");
                }
            })

            $("#submitcreatequestion").click(function() {
                var question = document.getElementById("questiontext").value;
                var answer = document.getElementById("questionanswer").value;
                var value = document.getElementById("questionvalue").value;
                var hint = document.getElementById("questionhint").value;
                var hintvalue = document.getElementById("questionhintvalue").value;

                $.ajax({
                        type: "POST",
                        url: ajaxUrlQuestions,
                        data: '{"Question":"' + question + '", "Answer": "' 
                            + answer +'", "Value": "' + value + '", "Hint": "' 
                            + hint + '", "HintValue": "' + hintvalue + '", "Admin": "' 
                            + adminid + '"}',
                        contentType: "application/json"
                    }).done(function(result) {
                        if (result.recordset[0]["question_id"] != 0) {
                            alert("Question creation success");

                            document.getElementById("questiontext").value = "";
                            document.getElementById("questionanswer").value = "";
                            document.getElementById("questionvalue").value = "";
                            document.getElementById("questionhint").value = "";
                            document.getElementById("questionhintvalue").value = "";
                        }
                        else {
                            alert("Question creation failure");
                            document.getElementById("btnSubmit").disabled = false;
                        }
                    });
            });

            $("#submitcreateadmin").click(function() {
                var first = document.getElementById("adminfirst").value;
                var last = document.getElementById("adminlast").value;
                var login = document.getElementById("adminlogin").value;
                var pwd = "";

                $.ajax({
                        type: "POST",
                        url: ajaxUrlAdmins,
                        data: '{"First":"' + first + '", "Last": "' 
                            + last +'", "Username": "' + login + '", "Pwd": "' 
                            + pwd + '"}',
                        contentType: "application/json"
                    }).done(function(result) {
                        if (result.recordset[0]["admin_id"] != 0) {
                            alert("Admin creation success");

                            document.getElementById("adminfirst").value = "";
                            document.getElementById("adminlast").value = "";
                            document.getElementById("adminlogin").value = "";
                        }
                        else {
                            alert("Admin creation failure");
                            document.getElementById("btnSubmit").disabled = false;
                        }
                    });
            })
        });
    </script>
</body>