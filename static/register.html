<!DOCTYPE html>
<head>
    <title>Team Registration</title>
    <link rel="stylesheet" href="./css styles/register.css">
</head>
<body>

    <div class="flex">
        <p class="header-sub-title" id="word"></p><p class="header-sub-title blink">|</p>
    </div>

    <div id="loginBox">
    <label>Team Name: </label>
    <br/>
    <input type="text" id="tbName"/>
    <br/>

    <label>Team Password: </label>
    <br/>
    <input type="password" id="tbPass"/>
    <br/>

    <label>Confirm Password: </label>
    <br/>
    <input type="password" id="tbConfirm"/>
    <br/>

    <button id="btnSubmit">Submit</button>
    </div>

    <script type="text/javascript" src="./scripts/register_type.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {

            var input = document.getElementById("tbConfirm");

            input.addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    document.getElementById("btnSubmit").click();
                }
            });

            $("#btnSubmit").click(function() {
                document.getElementById("btnSubmit").disabled = true;

                const ajaxUrl = "http://localhost:8080/api/teams";
                var registerUrl = "http://localhost:8080/players.html";

                var user = document.getElementById("tbName").value;
                var pass = document.getElementById("tbPass").value;
                var confirm = document.getElementById("tbConfirm").value;

                if (pass === confirm) {
                    $.ajax({
                        type: "POST",
                        url: ajaxUrl,
                        data: '{"Name":"' + user + '", "Pwd": "' + pass +'"}',
                        contentType: "application/json"
                    }).done(function(result) {
                        if (result.recordset[0]["team_id"] != 0) {
                            sessionStorage.setItem("teamid", result.recordset[0]["team_id"]);
                            //registerUrl += result.recordset[0]["team_id"];
                            window.location.replace(registerUrl);
                        }
                        else {
                            alert("Account creation failure");
                            document.getElementById("btnSubmit").disabled = false;
                        }
                    });
                }
                else {
                    alert("Passwords do not match");
                    document.getElementById("btnSubmit").disabled = false;
                }
            });
        });
        
    </script>
</body>