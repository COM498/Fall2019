<!DOCTYPE html>
<head>
    <title>Waiting For Event</title>
    <link rel="stylesheet" href="./css styles/dashboard.css">
</head>
<body>

    <h1 class="hacker" id="timelabel">Until Event:</h1> 
    <h2 class="hacker" id="txt"></h2>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            
            const ajaxUrlEvent = "http://localhost:8080/api/currentevent";
            var gotoUrlDash = "http://localhost:8080/dashboard.html";

            var passedUrl = window.location.href.toString();
            const teamid = passedUrl.substring(passedUrl.indexOf('team=')+5);

            var eventid;
            var countDownDate = new Date();
            $.ajax({
                type: "GET",
                url: ajaxUrlEvent
            }).done(function(result) {
                if (result.recordset[0]["event_id"] > 0) {
                    eventid = result.recordset[0]["event_id"];
                    var sDate = new Date(result.recordset[0]["start_date"].replace("Z",""));
                    var sTime = new Date(result.recordset[0]["start_time"].replace("Z", ""));

                    sDate.setHours(sTime.getHours());
                    sDate.setMinutes(sTime.getMinutes());
                    sDate.setSeconds(sTime.getSeconds());

                    countDownDate = sDate;
                }
            })

            countDownDate = countDownDate.getTime();

            // Update the count down every 1 second
            var x = setInterval(function() {

            // Get today's date and time
            var now = new Date().getTime();
                
            // Find the distance between now and the count down date
            var distance = countDownDate - now;
                
            // Time calculations for days, hours, minutes and seconds
            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
            // Output the result in an element with id="demo"
            document.getElementById("txt").innerHTML = days + "d " + hours + "h "
            + minutes + "m " + seconds + "s ";
                
            // If the count down is over, write some text 
            if (distance < 0) {
                clearInterval(x);
                document.getElementById("txt").innerHTML = "LOADING...";

                gotoUrlDash += "team=" + teamid + "&event=" + eventid;
                window.location.href = gotoUrlDash;
            }
            }, 1000);

        })
    </script>
</body>
</html>